# 更新日志

## [优化版本] - 2025-12-24

### 新增功能
- ✨ 支持配置文件（config.json）自定义设置
- ✨ Cookie 有效性自动检查，避免重复登录
- ✨ 新增 `-saveDir` 参数，可自定义视频保存目录
- ✨ 批量下载支持空行和注释（# 开头的行）
- ✨ 更详细的错误信息和友好的用户提示
- ✨ 登录过程提示优化，显示"请在浏览器中完成登录..."

### 优化改进

#### 稳定性提升
- 🔧 完善的错误处理机制，所有函数都正确返回和处理错误
- 🔧 并发安全保护，使用 sync.Mutex 保护共享变量 errCount
- 🔧 安全的类型断言，避免 panic
- 🔧 FFmpeg 转换失败时输出详细的错误信息
- 🔧 更新 chromedp 到最新版本 (v0.14.2)，兼容最新 Chrome 浏览器
- 🔧 抑制 Chrome DevTools Protocol 非致命错误日志
- 🔧 改进 Chrome 启动参数，禁用自动化检测

#### 性能优化
- ⚡ HTTP 客户端连接池复用，提升网络性能
- ⚡ 使用 io.Copy 进行流式文件合并，大幅减少内存占用
- ⚡ 优化的并发控制机制

#### 用户体验
- 💄 专业的错误信息（移除不当用语）
- 💄 参数验证，线程数范围检查（1-100）
- 💄 批量下载时显示行号和进度
- 💄 失败任务统计和错误汇总
- 💄 程序完成时显示友好的提示信息

#### 安全性
- 🔒 Cookies 文件权限从 0644 改为 0600，提升安全性
- 🔒 输入参数验证和清理

#### 代码质量
- 📝 完善的代码注释
- 📝 更新和优化 README 文档
- 📝 添加配置文件示例
- 📝 移除所有不专业的错误信息

### 修复的问题
- 🐛 修复并发访问 errCount 导致的数据竞争
- 🐛 修复 FFmpeg 路径硬编码问题
- 🐛 修复类型断言可能导致的 panic
- 🐛 修复批量下载时每次都需要重新登录的问题
- 🐛 修复文件合并时内存占用过高的问题

### 技术债务清理
- 🧹 移除未使用的代码
- 🧹 统一错误处理模式
- 🧹 优化导入包的组织

---

## [原始版本]

初始版本，基本功能实现。
